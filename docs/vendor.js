const detectHover={update(){"undefined"!=typeof window&&"function"==typeof window.matchMedia&&(detectHover.hover=window.matchMedia("(hover: hover)").matches,detectHover.none=window.matchMedia("(hover: none)").matches||window.matchMedia("(hover: on-demand)").matches,detectHover.anyHover=window.matchMedia("(any-hover: hover)").matches,detectHover.anyNone=window.matchMedia("(any-hover: none)").matches||window.matchMedia("(any-hover: on-demand)").matches)}},detectPointer={update(){"undefined"!=typeof window&&"function"==typeof window.matchMedia&&(detectPointer.fine=window.matchMedia("(pointer: fine)").matches,detectPointer.coarse=window.matchMedia("(pointer: coarse)").matches,detectPointer.none=window.matchMedia("(pointer: none)").matches,detectPointer.anyFine=window.matchMedia("(any-pointer: fine)").matches,detectPointer.anyCoarse=window.matchMedia("(any-pointer: coarse)").matches,detectPointer.anyNone=window.matchMedia("(any-pointer: none)").matches)}},detectTouchEvents={update(){"undefined"!=typeof window&&(detectTouchEvents.hasSupport="ontouchstart"in window,detectTouchEvents.browserSupportsApi=Boolean(window.TouchEvent))}},detectPassiveEvents={update(){if("undefined"!=typeof window&&"function"==typeof window.addEventListener){let e=!1;const t=Object.defineProperty({},"passive",{get(){e=!0}}),d=()=>{};window.addEventListener("testPassiveEventSupport",d,t),window.removeEventListener("testPassiveEventSupport",d,t),detectPassiveEvents.hasSupport=e}}},detectIt={state:{detectHover,detectPointer,detectTouchEvents,detectPassiveEvents},update(){detectIt.state.detectHover.update(),detectIt.state.detectPointer.update(),detectIt.state.detectTouchEvents.update(),detectIt.state.detectPassiveEvents.update(),detectIt.updateOnlyOwnProperties()},updateOnlyOwnProperties(){if("undefined"!=typeof window){detectIt.passiveEvents=detectIt.state.detectPassiveEvents.hasSupport||!1,detectIt.hasTouch=detectIt.state.detectTouchEvents.hasSupport||!1,detectIt.deviceType=detectIt.hasTouch?"touchOnly":"mouseOnly",detectIt.hasTouch&&Object.keys(detectIt.state.detectHover).filter(e=>"update"!==e).every(e=>!1===detectIt.state.detectHover[e])&&Object.keys(detectIt.state.detectPointer).filter(e=>"update"!==e).every(e=>!1===detectIt.state.detectPointer[e])&&(window.navigator&&/android/.test(window.navigator.userAgent.toLowerCase())&&(detectIt.deviceType="touchOnly"),detectIt.deviceType="hybrid"),detectIt.hasTouch&&(detectIt.state.detectHover.anyHover||detectIt.state.detectPointer.anyFine)&&(detectIt.deviceType="hybrid"),detectIt.hasMouse="touchOnly"!==detectIt.deviceType,detectIt.primaryInput=("mouseOnly"===detectIt.deviceType?"mouse":"touchOnly"===detectIt.deviceType&&"touch")||detectIt.state.detectPointer.fine&&"mouse"||detectIt.state.detectPointer.coarse&&"touch"||"mouse";const e=e=>e>=59&&e<62;/windows/.test(window.navigator.userAgent.toLowerCase())&&/chrome/.test(window.navigator.userAgent.toLowerCase())&&e(parseInt(/Chrome\/([0-9.]+)/.exec(navigator.userAgent)[1],10))&&detectIt.hasTouch&&(detectIt.deviceType="hybrid",detectIt.hasMouse=!0,detectIt.primaryInput="mouse")}}};detectIt.update(),"hybrid"!==detectIt.deviceType&&"mouseOnly"!==detectIt.deviceType||!detectIt.hasMouse||"mouse"!==detectIt.primaryInput||document.body.classList.add("hasHover");
const menuNavOpen=document.querySelector(".button-burger"),menuNavClose=document.querySelector(".button-close"),menuNav=document.querySelector(".main-nav"),menuNavInner=document.querySelector(".main-nav__inner");function toggleMainNav(){menuNavInner.classList.toggle("main-nav__inner_hidden"),menuNav.classList.toggle("main-nav__hidden")}menuNavOpen.addEventListener("click",toggleMainNav),menuNavClose.addEventListener("click",toggleMainNav);
const container=document.querySelector(".events");let template='\n    <div class="event {{ type }} {{ size }}">\n        <div class="event__close event-control event-control_disabled">\n            <svg width="14" height="14" xmlns="http://www.w3.org/2000/svg">\n                <path d="M8.061 7l4.72-4.719a.75.75 0 1 0-1.062-1.061L7 5.939l-4.719-4.72A.75.75 0 1 0 1.22 2.282l4.719 4.72-4.72 4.718a.75.75 0 1 0 1.062 1.061l4.72-4.719 4.718 4.72a.748.748 0 0 0 1.061 0 .75.75 0 0 0 0-1.062L8.061 7z"/>\n            </svg>\n        </div>\n        <div class="event__open event-control event-control_disabled">\n            <svg width="10" height="16" xmlns="http://www.w3.org/2000/svg" fill="#666" stroke="#666">\n                <path d="M8.266 8.691L2.24 14.715a.98.98 0 1 1-1.387-1.387l5.33-5.33-5.33-5.33A.981.981 0 0 1 2.24 1.28l6.025 6.024a.978.978 0 0 1 0 1.387z"/>\n            </svg>\n        </div>\n        <div class="event__main-info">\n            <svg class="{{ event__icon }}">\n                <use class="event__icon_source" xlink:href="#{{ icon }}"/>\n            </svg>\n            <span class="{{ event__title }}">{{ title }}</span>\n        </div>\n        <div class="{{ event__info }}">\n            <span class="event__source">{{ source }}</span>\n            <span class="event__time">{{ time }}</span>\n        </div>\n        <div class="additional-info additional-info_disabled">\n            <span class="event__description">{{ description }}</span>\n            {{data}}\n        </div>\n        \n    </div>\n',eventsStr="";function templater(n,e){for(let t in e){let s=e[t];"type"===t&&("critical"===e[t]&&(s="event-critical",n=(n=(n=n.replace(new RegExp("{{ event__icon }}","ig"),"event__icon event__icon_critical")).replace(new RegExp("event__close","ig"),"event__close event__close_white")).replace(new RegExp("{{ event__title }}","ig"),"event__title event__title_critical")),n=(n=n.replace(new RegExp("{{ event__icon }}","ig"),"event__icon")).replace(new RegExp("{{ event__title }}","ig"),"event__title")),"size"===t&&(s="l"===e[t]?"event-big":"m"===e[t]?"event-middle":""),n="description"===t&&e[t]?(n=n.replace(new RegExp("additional-info_disabled","ig"),"")).replace(new RegExp("{{ event__info }}","ig"),"event__info"):n.replace(new RegExp("{{ event__info }}","ig"),"event__info event__info_last"),"description"!==t||e.data||(n=n.replace(new RegExp("{{\\s?data\\s?}}","ig"),"")),"data"===t&&("thermal"===e.icon&&(s='\n                    <div class="event__data">\n                 <div class="data__climate">\n                        <div><span class="climate__type">Температура: </span><span class="climate__value">24 С</span></div>\n                        <div><span class="climate__type">Влажность: </span><span class="climate__value">80%</span></div>\n                    </div>\n                    </div>\n                '),"fridge"===e.icon&&(s='\n                 <div class="event__data">\n                 <div class="data__buttons">\n                        <button class="data__button">Да</button>\n                        <button class="data__button">Нет</button>\n                    </div>\n                    </div>\n                '),"music"===e.icon&&(s='\n                    <div class="event__data">\n                    <div class="data__music">\n                        <div class="data__music_composition">\n                            <img src="./album-cover.png" alt="Обложка альбома" class="data__music_image">\n                            <div>\n                                <span class="data__music_composition-title">Florence & The Machine - Big God</span>\n                                <div class="data__music_composition-range">\n                                    <input type="range" min="0" max="271" value="70" class="data__music_composition-range_input">\n                                    <span class="data__music_composition-duration">4:31</span>\n                                </div>\n                            </div>\n                        </div>\n                        <div class="data__music_composition-controls">\n                            <div>\n                                <svg class="music__icon music__icon_prev">\n                                    <use xlink:href=\'#music-control\'></use>\n                                </svg>\n                                <svg class="music__icon music__icon_next">\n                                    <use xlink:href=\'#music-control\'></use>\n                                </svg>\n                            </div>\n                            <input type="range" min="0" max="100" value="80" class="data__music_composition-volume">\n                            <span class="data__music_composition-duration">80%</span>\n                        </div>\n                    </div>\n                </div>\n                '),"cam"===e.icon&&(s=detectIt.hasTouch?'\n<div class="event__data">\n                 <div class="data__image data__image_wrapper-touchable">\n                        \x3c!--<picture>--\x3e\n                        \x3c!--<sourse media="(max-width:415px)" srcset="cam.jpg">--\x3e\n                        \x3c!--<img srcset="cam.png,--\x3e\n                                     \x3c!--cam2x.png 2x,--\x3e\n                                     \x3c!--cam3x.png 3x"--\x3e\n                             \x3c!--src="cam.png" alt="Снимок камеры с пылесосом">--\x3e\n                        \x3c!--</picture>--\x3e\n                        <img class="data__image_touchable" srcset="cam.png,\n                                     cam2x.png 2x,\n                                     cam3x.png 3x"\n                             src="cam.png" alt="Снимок камеры с пылесосом">\n                    </div>\n                    <div class="event__touch-info">\n                        <div><span class="touch-info_zoom">Приближение: </span><span class="touch-info__value zoom__value">1.7</span></div>\n                        <div><span class="touch-info_brightness">Яркость: </span><span class="touch-info__value brightness__value">50%</span></div>\n                    </div>\n                    </div>\n                ':'\n<div class="event__data">\n                 <div class="data__image">\n                        \x3c!--<picture>--\x3e\n                        \x3c!--<sourse media="(max-width:415px)" srcset="cam.jpg">--\x3e\n                        <img class="data__image_touchable" srcset="cam.png,\n                                     cam2x.png 2x,\n                                     cam3x.png 3x"\n                             src="cam.png" alt="Снимок камеры с пылесосом">\n                        \x3c!--</picture>--\x3e\n                    </div></div>'),"stats"===e.icon&&(s='\n<div class="event__data">\n                 <div class="data__image">\n                        <img src="./Richdata.svg" alt="График">\n                    </div>\n                    </div>\n                '));let a="{{\\s?"+t+"\\s?}}";n=n.replace(new RegExp(a,"ig"),s)}return n}function touchableLogic(){const n=document.querySelector(".data__image_touchable"),e=document.querySelector(".data__image_wrapper-touchable").getBoundingClientRect(),t=document.querySelector(".zoom__value"),s=document.querySelector(".brightness__value");let a={};const i={moving:!1,scaling:!1,rotating:!1,startPosition:{x:0,y:0},scale:1.7,brightness:.8,prevDist:0,prevRotate:0};n.addEventListener("pointerdown",n=>{a[n.pointerId]={start:{x:n.x,y:n.y},prev:{x:n.x,y:n.y},startPosition:{x:i.startPosition.x,y:i.startPosition.y}},1===Object.keys(a).length?i.moving=!0:2===Object.keys(a).length&&(i.moving=!1,i.scaling=!0,i.rotating=!0)}),n.addEventListener("pointermove",c=>{i.moving&&function(t){const s=t.x-a[t.pointerId].start.x;let c=n.getBoundingClientRect();e.left>=c.left+s&&e.right<=c.left+c.width+s&&(i.startPosition.x=a[t.pointerId].startPosition.x+s,n.style.transform=` scale(${i.scale}) translateX(${i.startPosition.x}px) translateY(${i.startPosition.y}px)`,a[t.pointerId].prev={x:t.x,y:t.y})}(c),i.scaling&&function(e){const s=[];for(let n in a)s.push({x:a[n].prev.x,y:a[n].prev.y});const c=Math.sqrt(Math.pow(s[0].x-s[1].x,2)+Math.pow(s[0].y-s[1].y,2));let o=c<i.prevDist?.99*i.scale:1.01*i.scale;o>3.3&&(o=3.3);o<=1.3&&(o=1.3);i.scale=o,i.prevDist=c,t.innerText=i.scale.toFixed(1),n.style.transform=` scale(${i.scale}) translateX(${i.startPosition.x}px) translateY(${i.startPosition.y}px)`,a[e.pointerId].prev={x:e.x,y:e.y}}(c),i.rotating&&function(e){const t=[];for(let n in a)t.push({x:a[n].prev.x,y:a[n].prev.y});let c=Math.atan((t[1].y-t[0].y)/(t[1].x-t[0].x));Math.abs(c-i.prevRotate)>Math.PI&&(c-=-Math.PI);let o=c>i.prevRotate?1.01*i.brightness:.99*i.brightness;o>1&&(o=1);o<=0&&(o=0);i.brightness=o,i.prevRotate=c,s.innerText=`${parseInt(100*i.brightness)}%`,n.style.filter=`brightness(${i.brightness})`,a[e.pointerId].prev={x:e.x,y:e.y}}(c)}),n.addEventListener("pointerup",function(n){i.moving=!1,i.scaling=!1,i.rotating=!1,delete a[n.pointerId]})}fetch("./events.json").then(n=>n.json()).then(n=>{const e=n.events;for(let n in e)eventsStr+=templater(template,e[n]);container.innerHTML+=eventsStr}).then(()=>touchableLogic());